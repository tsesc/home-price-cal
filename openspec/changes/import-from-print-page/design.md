## Context

房價計算器目前需要使用者手動輸入所有欄位。內政部實價登錄列印頁面提供純文字格式的交易明細，包含建物面積、價格、車位等完整資訊。使用者可以透過瀏覽器全選複製取得該文字。

實價登錄列印頁面的文字結構為固定格式的標籤值配對（如「交易總價: 14,340,000 元」），建物資料以表格形式呈現，包含多筆建物記錄（主建物、共同使用部分等）。

## Goals / Non-Goals

**Goals:**
- 使用者貼上實價登錄列印頁面的純文字後，自動解析所有相關欄位
- 正確區分主建物、陽台、雨遮、共同使用部分（含車位/不含車位）
- 自動計算單價（不含車位）
- 提供預覽畫面讓使用者確認後再填入

**Non-Goals:**
- 不做網頁爬蟲或 API 串接（僅處理使用者貼上的文字）
- 不支援非住宅交易類型的解析
- 不處理多戶交易（僅支援單戶 + 單車位）

## Decisions

### 1. 純文字解析而非 HTML 解析
使用正規表達式解析純文字，而非要求使用者提供 HTML。
- **理由**: 使用者透過瀏覽器全選複製得到的是純文字，操作最簡單
- **替代方案**: 要求貼上 HTML 或提供 URL → 增加操作複雜度和跨域問題

### 2. 建物資料分類邏輯
根據文字描述區分建物資料類型：
- 含有「主建物」且有面積的行 → 主建物面積（可能有多筆，需加總）
- 含有「陽台」→ 陽台面積
- 含有「雨遮」→ 雨遮面積
- 含有「共同使用部分」且描述含「停車空間、車道」等 → 含車位的共同使用部分
- 含有「共同使用部分」且描述含「電梯、梯廳、機房」等 → 不含車位的共同使用部分
- **理由**: 實價登錄的建物資料每筆都有主要用途描述，可據此分類

### 3. 共同使用部分歸類策略
共同使用部分項目中，若描述僅包含停車相關項目（防空避難室兼停車空間、車道、停車空間），歸類為車位相關公設。其他歸類為一般公設。
- **理由**: 與現有計算器的 commonArea1/commonArea2 分類邏輯一致

### 4. 單價計算方式
單價 = (交易總價 - 車位交易價格) / 建物總面積（不含車位）
- 建物總面積（不含車位） = 主建物 + 陽台 + 雨遮 + 一般共同使用部分（不含車位公設）
- **注意**: 車位面積直接從車位資料表取得，不從共同使用部分推算

### 5. UI 實作方式
使用 modal dialog（對話框）而非獨立頁面或側邊欄。
- **理由**: 功能單一且操作步驟少，dialog 足夠；不需要引入路由

## Risks / Trade-offs

- [實價登錄格式變更] → 解析器基於正規表達式，若官方調整頁面文字格式可能失效。緩解：解析失敗時顯示清楚的錯誤訊息，使用者仍可手動輸入。
- [多筆主建物加總] → 部分交易包含多筆小面積主建物（如管理員室 0.03 坪），需正確加總。緩解：將所有標記為主建物的面積累加。
- [共同使用部分分類不精確] → 少數案例可能包含混合用途的共同使用部分。緩解：預覽畫面允許使用者手動調整。
